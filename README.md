## Getting Started
This project is meant to automate the process of creating the database, tables, indexes, compound indexes and generating fake data to work with on the FFR Application. This application is built with [Node.js](https://nodejs.org/en/).


### Cloning the project
Simply clone the project to your specific directory and install all dependencies either with NPM or Yarn.

``` sh
# Clone the project
git clone git@gitlab:FFR-projects/ffr-be-automation.git /PATH/TO/DIRECTORY/
```

### Dependencies
The following packages are required to successfully automate and seed the database.

```json
{
  "dependencies": {
    "faker": "^4.1.0",
    "moment": "^2.22.1",
    "npm": "^6.0.0",
    "rethinkdb": "2.3.6",
    "rethinkdb-createtables": "^1.0.1",
    "rethinkdb-migrate": "^1.3.0",
    "rethinkdb-pool": "^1.1.0"
  }
}
```
You can install all packages with Yarn or NPM.
``` sh
# install using npm
npm install

# isntall using yarn
yarn install
```


### Configuring the automation process
The **`configuration/automate-config.js`** determines what tables will be seeded to the DB.

``` json
  billingConfig: {
    "automate": true,
    "exclude": []
  },
  clientinfoConfig: {
    "automate": true,
    "exclude": []
  },
  coachingConfig: {
    "automate": true,
    "exclude": []
  }...
```

### Hard coded data
Most of the data is generated by faker but in some cases we want some data to be hard coded. For this we can create a **`data/<CATEGORY>.json`** file.

**`example: billing.json`**

```json 

{
  "tbl_billto": {
    "types": [
      "Medicare",
      "Medicaid"
    ]
  },
  "tbl_medical_ins": {
    "types": [
      "None",
      "Medicare",
      "Medicaid",
      "Private",
      "MAP/County Program",
      "VA",
      "Other"
    ]
  }
}
```

### Creating a new migration

```terminal
rethinkdb-migrate create <NAME_OF_TABLE>
```

**`example: 20180801234033-NAME_OF_TABLE`**

```javascript
const upDown = require('../helpers/updown')

// Get automation configurations for this file.
const config = require('../configuration/automate-config').billingConfig

// Get any data needed for use in seeder.
const billing = require('../data/billing.json')

// Initial state of seeder data.
const seeder = []

// create seed data.
billing.tbl_billto.types.forEach((type, i) => {
  seeder.push({
    'BILLTO_NAME': type,
    'ID': i + 1
  })
})

// Data to be seeded to db.
const data = {
  'seeder': seeder,
  'indexes': ['ID', 'BILLTO_NAME'],
  'compoundIndexes': [],
  'table': 'TBL_BILLTO'
}

module.exports.up = async function (r, connection) {
  await upDown(r, connection, data, config, 'up')
}

module.exports.down = async function (r, connection) {
  await upDown(r, connection, data, config, 'down')
}
```

## Getting Started
This project is meant to automate the process of creating the database, tables, indexes, compound indexes and generating fake data to work with on the FFR Application. This application is built with [Node.js](https://nodejs.org/en/).


### Cloning the project
Simply clone the project to your spacific directory and install all dependencies either with NPM or Yarn.

``` sh
# Clone the project
git clone git@gitlab:FFR-projects/ffr-be-automation.git /PATH/TO/DIRECTORY/
```

### Dependencies
The following packages are required to successfuly automate and seed the database.

```json
{
  "dependencies": {
    "async": "^2.6.0",
    "faker": "^4.1.0",
    "install": "^0.11.0",
    "moment": "^2.22.1",
    "npm": "^6.0.0",
    "rethinkdb": "^2.3.3",
    "rethinkdb-createtables": "^1.0.1",
    "ssn": "^1.0.3"
  }
}
```
You can install all packages with Yarn or NPM
``` sh
# install using npm
npm install

# isntall using yarn
yarn install
```

## Table Configurations
There are a coupld of steps that need to be configured for the automation process to work.

### Declaring tables to automate
Each table must exist in a pre defined directory. This is set in  **`configuration/automate-config.js`**. Only directories with **`"automate": true`** will be automated.

```json
{
  "directory" : "./tables/DIRECTORY_NAME",
  "automate" : true, 
  "exclude" : []
}
```

### Table settings
Most of the data is generated by faker but in some cases we want some data to be hard coded. For this we use **`configuration/tables-config.js`**.

```json 
  "client_notes": {
    "total" 8
  },
  "tbl_checkup_referral_source": {
    "types": ["self", "Mother", "Father", "Sister", "Friend"]
  },
```


## Many to one tables
In this example we will look at how to create a many-to-one model table.


### Many to one structure
All tables by default should be in **`tables/SOME_CATORY/TABLE_NAME`**. Below is an example of the **`CLIENT_NOTES`** table.

```javascript
const faker = require('faker')
const random = require('../../helpers/random/index')
const tables = require('../../configuration/tables-config') 

// Seed data.
const seeder = []

// Since this table has a relation of many notes to one recovery
// we need to set recId to 1
let recId = 1

// create seed data - total is set in tables-config.
for(let i = 1; i <= tables.client_notes.total; i++){

  // Many to one ids. Making sure that ID does not go pass the number of recoverees.
  if(recId > tables.tbl_recoverees.total) recId = 1

  // Loop and create data to seed.
  seeder.push({
    "ID": recId,
    "NOTE": faker.random.words(10),
    "STAMP": random.date()
  })
  recId++
}

module.exports = {
  "seeder": seeder,
  "indexes": ['ID', 'STAMP'],
  "compoundIndexes": [],
  "table" : 'CLIENT_NOTES'
}

```
### Many to one breakdown
The number of notes that gets generated is set in **`configuration/tables-config.js client_notes{}`**".
``` javascript 
for(let i = 1; i <= tables.client_notes.total; i++){
```

There can be many notes to a recoveree [many-to-one](https://en.wikipedia.org/wiki/Many-to-one_(data_model)) and this is the case with mostsly all the tables being genereated. We need to make sure that the ID can't be higher than the amount of recoverees in the system. 
``` javascript
if(recId > tables.tbl_recoverees.total) recId = 1
```

Data gets added to the seeder array that then gets exported out.
``` javascript
seeder.push({
  "ID": recId,
  "NOTE": faker.random.words(10),
  "STAMP": random.date()
})
```

We need to export out the data to be seeded along with the table name, indexes and compound indexes.
``` javascript
module.exports = {
  "seeder": seeder,
  "indexes": ['ID', 'STAMP'],
  "compoundIndexes": [],
  "table" : 'CLIENT_NOTES'
}
```

## Options tables
In this example we will look at how to create a many-to-one model table.

### Options table structure
All tables by default should be in **`tables/SOME_CATORY/TABLE_NAME`**. Below is an example of the **`TBL_FAMILY_TYPES`** table.

```javascript
const tables = require('../../configuration/tables-config')

// Seed data.
const seeder = []

// create seed data.
tables.tbl_family.types.forEach((type, i) => {
  seeder.push( {
    "FAMILY": type,
    "ID": i + 1
  })
})

module.exports = {
  "seeder": seeder,
  "indexes": ['ID'],
  "compoundIndexes": [],
  "table": "TBL_FAMILY"
}

```

### Options table breakdown
The family types get generated from **`configuration/tables-config.js tbl_family.types[]`**.

``` javascript
tables.tbl_family.types.forEach((type, i) => {
  ...
}
```

Data gets added to the seeder array then gets exported out.
``` javascript
seeder.push( {
  "FAMILY": type,
  "ID": i + 1
})
```

We need to export out the data to be seeded along with the table name, indexes and compound indexes.
``` javascript
module.exports = {
  "seeder": seeder,
  "indexes": ['ID'],
  "compoundIndexes": [],
  "table": "TBL_FAMILY"
}
```
